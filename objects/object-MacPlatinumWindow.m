/*

 HOT DOG Linux

 Copyright (c) 2020 Arthur Choung. All rights reserved.

 Email: arthur -at- hotdoglinux.com

 This file is part of HOT DOG Linux.

 HOT DOG Linux is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
 the Free Software Foundation, either version 3 of the License, or
 (at your option) any later version.

 This program is distributed in the hope that it will be useful,
 but WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU General Public License for more details.

 You should have received a copy of the GNU General Public License
 along with this program.  If not, see <https://www.gnu.org/licenses/>.

 */

#import "HOTDOG.h"

@implementation Definitions(fjkdlsjfiowejfklsdjfklsdkljf)
+ (char *)cStringForMacPlatinumInactiveTitleBarPalette
{
    return
"b #555555\n"
". #63639C\n"
"X #DDDDDD\n"
"o #EEEEEE\n"
;
}
+ (char *)cStringForMacPlatinumInactiveTitleBarLeft
{
    return
"bbbbbb\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXb\n"
;
}
+ (char *)cStringForMacPlatinumInactiveTitleBarMiddle
{
    return
"b\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"X\n"
"b\n"
;
}
+ (char *)cStringForMacPlatinumInactiveTitleBarRight
{
    return
"bbbbbbbbbbbbbbbbbb \n"
"XXXXXXXXXXXXXXXXXb \n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXbb\n"
"bbbbbbbbbbbbbXXXXbb\n"
;
}
+ (char *)cStringForMacPlatinumInactiveLeftBorderPalette
{
    return
"b #555555\n"
"X #DDDDDD\n"
"o #DDDDDD\n"
"O #DDDDDD\n"
;
}
+ (char *)cStringForMacPlatinumInactiveBottomBorderPalette
{
    return
"b #555555\n"
". #63639C\n"
"X #DDDDDD\n"
"o #EEEEEE\n"
"O #FFFFFF\n"
;
}
+ (char *)cStringForMacPlatinumInactiveBottomBorderLeft
{
    return
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXb\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bXXXXX\n"
"bbbbbb\n"
"  bbbb\n"
;
}
+ (char *)cStringForMacPlatinumInactiveBottomBorderMiddle
{
    return
"b\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"o\n"
"b\n"
"X\n"
"X\n"
"X\n"
"X\n"
"b\n"
"b\n"
;
}
+ (char *)cStringForMacPlatinumInactiveBottomBorderRight
{
    return
"bbbbbbbbbbbbbbbbXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"bXXXXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXXXXbb\n"
"XXXXXXXXXXXXXXXXXXXXbb\n"
"bbbbbbbbbbbbbbbbbbbbbb\n"
"bbbbbbbbbbbbbbbbbbbbbb\n"
;
}

+ (char *)cStringForMacPlatinumActiveTitleBarLeftPalette
{
    return
"  #000000\n"
". #222222\n"
"X #555555\n"
"o #777777\n"
"O #63639C\n"
"+ #888888\n"
"@ #999999\n"
"# #AAAAAA\n"
"$ #BBBBBB\n"
"% #CCCCCC\n"
"& #DDDDDD\n"
"* #EEEEEE\n"
"= #FFFFFF\n"
;
}
+ (char *)cStringForMacPlatinumActiveTitleBarLeft
{
    return
"bbbbbbbbbbbbbbbbbbbbbb\n"
"b=====================\n"
"b=%%%%%%%%%%%%%%%%%%%%\n"
"b=%%%%%%%%%%%%%%%%%%%%\n"
"b=%%++++++++++++%%%%%=\n"
"b=%%+...........=%%%%%\n"
"b=%%+.=%%%%%%%%.=%%%%=\n"
"b=%%+.%@@##$$%+.=%%%%%\n"
"b=%%+.%@##$$%%+.=%%%%=\n"
"b=%%+.%##$$%%&+.=%%%%%\n"
"b=%%+.%#$$%%&&+.=%%%%=\n"
"b=%%+.%$$%%&&*+.=%%%%%\n"
"b=%%+.%$%%&&**+.=%%%%=\n"
"b=%%+.%%%&&**=+.=%%%%%\n"
"b=%%+.%++++++++.=%%%%=\n"
"b=%%+...........=%%%%%\n"
"b=%%%============%%%%%\n"
"b=%%%%%%%%%%%%%%%%%%%%\n"
"b=%%%%%%%%%%%%%%%%%%%%\n"
"b=%%%%%%%%%%%%%%%%%%%%\n"
"b=%%@@@@@@@@@@@@@@@@@@\n"
"b=%%@bbbbbbbbbbbbbbbbb\n"
;
}
+ (char *)cStringForMacPlatinumActiveTitleBarRightPalette
{
    return
"b #000000\n"
". #222222\n"
"X #777777\n"
"o #63639C\n"
"O #888888\n"
"+ #999999\n"
"@ #AAAAAA\n"
"# #BBBBBB\n"
"$ #CCCCCC\n"
"% #DDDDDD\n"
"& #EEEEEE\n"
"* #FFFFFF\n"
;
}
+ (char *)cStringForMacPlatinumActiveTitleBarMiddle
{
    return
"b\n"
"*\n"
"$\n"
"$\n"
"*\n"
"X\n"
"*\n"
"X\n"
"*\n"
"X\n"
"*\n"
"X\n"
"*\n"
"X\n"
"*\n"
"X\n"
"$\n"
"$\n"
"$\n"
"$\n"
"+\n"
"b\n"
;
}
+ (char *)cStringForMacPlatinumActiveTitleBarRight
{
    return
"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb \n"
"************************************$b \n"
"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$+bb\n"
"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$+bb\n"
"$$$$$OOOOOOOOOOOO$$$$OOOOOOOOOOOO$$$+bb\n"
"X$$$$O...........*$$$O...........*$$+bb\n"
"$$$$$O.*$$$$.$$$.*$$$O.*$$$$$$$$.*$$+bb\n"
"X$$$$O.$++@@.#$O.*$$$O.$++@@##$O.*$$+bb\n"
"$$$$$O.$+@@#.$$O.*$$$O.$+@@##$$O.*$$+bb\n"
"X$$$$O.$@@##.$%O.*$$$O...........*$$+bb\n"
"$$$$$O.$@##$.%%O.*$$$O.$@##$$%%O.*$$+bb\n"
"X$$$$O.......%&O.*$$$O...........*$$+bb\n"
"$$$$$O.$#$$%%&&O.*$$$O.$#$$%%&&O.*$$+bb\n"
"X$$$$O.$$$%%&&*O.*$$$O.$$$%%&&*O.*$$+bb\n"
"$$$$$O.$OOOOOOOO.*$$$O.$OOOOOOOO.*$$+bb\n"
"X$$$$O...........*$$$O...........*$$+bb\n"
"$$$$$$************$$$$************$$+bb\n"
"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$+bb\n"
"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$+bb\n"
"$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$+bb\n"
"+++++++++++++++++++++++++++++++++$$$+bb\n"
"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb*$$+bb\n"
;
}
+ (char *)cStringForMacPlatinumActiveTitleBarTextLeft
{
    return
"b\n"
"*\n"
"$\n"
"$\n"
"$\n"
"X\n"
"$\n"
"X\n"
"$\n"
"X\n"
"$\n"
"X\n"
"$\n"
"X\n"
"$\n"
"X\n"
"$\n"
"$\n"
"$\n"
"$\n"
"+\n"
"b\n"
;
}
+ (char *)cStringForMacPlatinumActiveTitleBarTextRight
{
    return
"b\n"
"*\n"
"$\n"
"$\n"
"*\n"
"$\n"
"*\n"
"$\n"
"*\n"
"$\n"
"*\n"
"$\n"
"*\n"
"$\n"
"*\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"+\n"
"b\n"
;
}
+ (char *)cStringForMacPlatinumLeftBorderPalette
{
    return
"b #000000\n"
". #63639C\n"
"X #999999\n"
"o #CCCCCC\n"
"O #FFFFFF\n"
;
}
+ (char *)cStringForMacPlatinumLeftBorderMiddle
{
    return
"bOooXb\n"
;
}

+ (char *)cStringForMacPlatinumBottomBorderPalette
{
    return
"b #000000\n"
". #555555\n"
"X #777777\n"
"o #63639C\n"
"O #888888\n"
"+ #999999\n"
"@ #AAAAAA\n"
"# #CCCCCC\n"
"$ #EEEEEE\n"
"% #FFFFFF\n"
;
}
+ (char *)cStringForMacPlatinumBottomBorderLeft
{
    return
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%##+b\n"
"b%###%\n"
"b%####\n"
"b%####\n"
"b#++++\n"
"bbbbbb\n"
;
}
+ (char *)cStringForMacPlatinumBottomBorderMiddle
{
    return
"b\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"$\n"
"b\n"
"%\n"
"#\n"
"#\n"
"+\n"
"b\n"
;
}
+ (char *)cStringForMacPlatinumBottomBorderRight
{
    return
"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb%##+bb\n"
".$$$$$$$$$$$$$$O$$$$$$$$$$$$$$b%%%%%%%%%%%%%%%%##+bb\n"
".$$$$$$$$$$$$$$O$$$$$$$$$$$$$$b%#################+bb\n"
".$$$$$$$$$$$$$$O$$$$$$$$$$$$$$b%#################+bb\n"
".$$$$$$$$O$$$$$O$$$$$O$$$$$$$$b%#######%%########+bb\n"
".$$$$$$$OO$$$$$O$$$$$OO$$$$$$$b%######%#X########+bb\n"
".$$$$$$OOO$$$$$O$$$$$OOO$$$$$$b%#####%#X#%%######+bb\n"
".$$$$$OOOO$$$$$O$$$$$OOOO$$$$$b%####%#X#%#X######+bb\n"
".$$$$$OOOO$$$$$O$$$$$OOOO$$$$$b%###%#X#%#X#%%####+bb\n"
".$$$$$$OOO$$$$$O$$$$$OOO$$$$$$b%##%#X#%#X#%#X####+bb\n"
".$$$$$$$OO$$$$$O$$$$$OO$$$$$$$b%##@X#%#X#%#X#####+bb\n"
".$$$$$$$$O$$$$$O$$$$$O$$$$$$$$b%####%#X#%#X######+bb\n"
".$$$$$$$$$$$$$$O$$$$$$$$$$$$$$b%####@X#%#X#######+bb\n"
".$$$$$$$$$$$$$$O$$$$$$$$$$$$$$b%######%#X########+bb\n"
".$$$$$$$$$$$$$$O$$$$$$$$$$$$$$b%######@X#########+bb\n"
"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb%#################+bb\n"
"%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%#################+bb\n"
"#################################################+bb\n"
"#################################################+bb\n"
"++++++++++++++++++++++++++++++++++++++++++++++++++bb\n"
"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb\n"
"bbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb\n"
;
}


+ (char *)cStringForMacPlatinumRightBorderPalette
{
    return
"b #000000\n"
". #555555\n"
"X #777777\n"
"o #63639C\n"
"O #888888\n"
"+ #999999\n"
"@ #AAAAAA\n"
"# #CCCCCC\n"
"$ #DDDDDD\n"
"% #EEEEEE\n"
"& #FFFFFF\n"
;
}
+ (char *)cStringForMacPlatinumRightBorderTop
{
    return
"b..............b&##+bb\n"
;
}
+ (char *)cStringForMacPlatinumRightBorderMiddle
{
    return
"b%%%%%%%%%%%%%%b&##+bb\n"
;
}
+ (char *)cStringForMacPlatinumRightBorderBottom
{
    return
"b..............b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%OO%%%%%%b&##+bb\n"
"b%%%%%OOOO%%%%%b&##+bb\n"
"b%%%%OOOOOO%%%%b&##+bb\n"
"b%%%OOOOOOOO%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"bOOOOOOOOOOOOOOb&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%OOOOOOOO%%%b&##+bb\n"
"b%%%%OOOOOO%%%%b&##+bb\n"
"b%%%%%OOOO%%%%%b&##+bb\n"
"b%%%%%%OO%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
"b%%%%%%%%%%%%%%b&##+bb\n"
//"bbbbbbbbbbbbbbbb&##+b\n"
;
}

+ (char *)cStringForMacPlatinumInactiveRightBorderPalette
{
    return
"b #555555\n"
". #63639C\n"
"X #DDDDDD\n"
"o #EEEEEE\n"
"O #FFFFFF\n"
;
}

+ (char *)cStringForMacPlatinumInactiveRightBorderTop
{
    return
"bbbbbbbbbbbbbbbbXXXXbb\n"
;
}
+ (char *)cStringForMacPlatinumInactiveRightBorderMiddle
{
    return
"boooooooooooooobXXXXbb\n"
;
}



+ (char *)cStringForMacPlatinumCloseButtonDownPalette
{
    return
"b #000000\n"
". #111111\n"
"X #222222\n"
"o #333333\n"
"O #444444\n"
"+ #555555\n"
"@ #666666\n"
"# #777777\n"
"$ #888888\n"
"% #999999\n"
"& #AAAAAA\n"
"* #BBBBBB\n"
"= #CCCCCC\n"
"- #DDDDDD\n"
"; #EEEEEE\n"
": #FFFFFF\n"
;
}
+ (char *)cStringForMacPlatinumCloseButtonDown
{
    return
"$$$$$$$$$$$$=\n"
"$XXXXXXXXXXX:\n"
"$XOO++@@##$X:\n"
"$XO++@@##$$X:\n"
"$X++@@##$$%X:\n"
"$X+@@##$$%%X:\n"
"$X@@##$$%%%X:\n"
"$X@##$$%%&%X:\n"
"$X##$$%%&&%X:\n"
"$X#$$%%&&*%X:\n"
"$X$$%%%%%%%X:\n"
"$XXXXXXXXXXX:\n"
"=::::::::::::\n"
;
}

+ (char *)cStringForMacPlatinumShadeButtonDownPalette
{
    return
"b #000000\n"
". #111111\n"
"X #222222\n"
"o #333333\n"
"O #444444\n"
"+ #555555\n"
"@ #666666\n"
"# #777777\n"
"$ #888888\n"
"% #999999\n"
"& #AAAAAA\n"
"* #BBBBBB\n"
"= #CCCCCC\n"
"- #DDDDDD\n"
"; #EEEEEE\n"
": #FFFFFF\n"
;
}
+ (char *)cStringForMacPlatinumShadeButtonDown
{
    return
"$$$$$$$$$$$$=\n"
"$XXXXXXXXXXX:\n"
"$XOO++@@##$X:\n"
"$XO++@@##$$X:\n"
"$X++@@##$$%X:\n"
"$XXXXXXXXXXX:\n"
"$X@@##$$%%%X:\n"
"$XXXXXXXXXXX:\n"
"$X##$$%%&&%X:\n"
"$X#$$%%&&*%X:\n"
"$X$$%%%%%%%X:\n"
"$XXXXXXXXXXX:\n"
"=::::::::::::\n"
;
}

+ (char *)cStringForMacPlatinumMaximizeButtonDownPalette
{
    return
"b #000000\n"
". #111111\n"
"X #222222\n"
"o #333333\n"
"O #444444\n"
"+ #555555\n"
"@ #666666\n"
"# #777777\n"
"$ #888888\n"
"% #999999\n"
"& #AAAAAA\n"
"* #BBBBBB\n"
"= #CCCCCC\n"
"- #DDDDDD\n"
"; #EEEEEE\n"
": #FFFFFF\n"
;
}
+ (char *)cStringForMacPlatinumMaximizeButtonDown
{
    return
"$$$$$$$$$$$$=\n"
"$XXXXXXXXXXX:\n"
"$XOO++@X##$X:\n"
"$XO++@@X#$$X:\n"
"$X++@@#X$$%X:\n"
"$X+@@##X$%%X:\n"
"$X@@##$X%%%X:\n"
"$XXXXXXX%&%X:\n"
"$X##$$%%&&%X:\n"
"$X#$$%%&&*%X:\n"
"$X$$%%%%%%%X:\n"
"$XXXXXXXXXXX:\n"
"=::::::::::::\n"
;
}
+ (char *)cStringForMacPlatinumMoveSelectionTopLeft
{
    return 
"bw\n"
"ww\n"
;
}
+ (char *)cStringForMacPlatinumMoveSelectionTop
{
    return 
"bw\n"
"bw\n"
;
}
+ (char *)cStringForMacPlatinumMoveSelectionLeft
{
    return 
"bb\n"
"ww\n"
;
}
+ (char *)cStringForMacPlatinumMoveSelectionRight
{
    return 
"bw\n"
"wb\n"
;
}
+ (char *)cStringForMacPlatinumMoveSelectionBottom
{
    return 
"bw\n"
"wb\n"
;
}
+ (char *)cStringForMacPlatinumResizeSelectionHorizontal
{
    return 
"bw\n"
;
}
+ (char *)cStringForMacPlatinumResizeSelectionVertical
{
    return 
"b\n"
"w\n"
;
}

@end

@interface MacPlatinumWindow : IvarObject
{
    int _leftBorder;
    int _rightBorder;
    int _topBorder;
    int _bottomBorder;
    int _hasShadow;

    char _buttonDown;
    char _buttonHover;
    int _buttonDownX;
    int _buttonDownY;
    int _buttonDownW;
    int _buttonDownH;
    Int4 _titleBarRect;
    Int4 _titleBarTextRect;
    Int4 _leftBorderRect;
    Int4 _rightBorderRect;
    Int4 _bottomBorderRect;
    Int4 _closeButtonRect;
    Int4 _shadeButtonRect;
    Int4 _maximizeButtonRect;
    Int4 _resizeButtonRect;
}
@end
@implementation MacPlatinumWindow
- (id)init
{
    self = [super init];
    if (self) {
        _leftBorder = 6;
        _rightBorder = 21+1;
        _topBorder = 22;
        _bottomBorder = 21+1;
        _hasShadow = 2;
    }
    return self;
}

- (void)calculateRects:(Int4)r
{
    char *titleBarLeft = [Definitions cStringForMacPlatinumActiveTitleBarLeft];
    char *titleBarMiddle = [Definitions cStringForMacPlatinumActiveTitleBarMiddle];
    char *titleBarRight = [Definitions cStringForMacPlatinumActiveTitleBarRight];
    int titleBarLeftWidth = [Definitions widthForCString:titleBarLeft];
    int titleBarHeight = [Definitions heightForCString:titleBarMiddle];

    _titleBarRect = [Definitions rectWithX:r.x y:r.y w:r.w h:titleBarHeight];
    _titleBarTextRect = _titleBarRect;
    _titleBarTextRect.x = titleBarLeftWidth+4;
    _titleBarTextRect.w -= titleBarLeftWidth+4;

    _leftBorderRect = r;
    _leftBorderRect.y += titleBarHeight;
    _leftBorderRect.h -= titleBarHeight;
    _leftBorderRect.h -= _bottomBorder;
    _leftBorderRect.w = _leftBorder;

    _rightBorderRect = r;
    _rightBorderRect.x += r.w-_rightBorder;
    _rightBorderRect.y += titleBarHeight;
    _rightBorderRect.h -= titleBarHeight;
    _rightBorderRect.h -= _bottomBorder;
    _rightBorderRect.w = _rightBorder;

    _bottomBorderRect = _titleBarRect;
    _bottomBorderRect.y += r.h-_bottomBorder;
    _bottomBorderRect.h = _bottomBorder;

    _closeButtonRect = _titleBarRect;
    _closeButtonRect.x += 4;
    _closeButtonRect.y += 4;
    _closeButtonRect.w = 13;
    _closeButtonRect.h = 13;

    _shadeButtonRect = _titleBarRect;
    _shadeButtonRect.x = _shadeButtonRect.x+_shadeButtonRect.w-18;
    _shadeButtonRect.y += 4;
    _shadeButtonRect.w = 13;
    _shadeButtonRect.h = 13;

    _maximizeButtonRect = _titleBarRect;
    _maximizeButtonRect.x = _maximizeButtonRect.x+_maximizeButtonRect.w-18-3-13;
    _maximizeButtonRect.y += 4;
    _maximizeButtonRect.w = 13;
    _maximizeButtonRect.h = 13;
}
- (void)drawInBitmap:(id)bitmap rect:(Int4)r
{
    [self drawInBitmap:bitmap rect:r context:nil];
}
- (void)drawInBitmap:(id)bitmap rect:(Int4)r context:(id)context
{
    int hasFocus = [context intValueForKey:@"hasFocus"];

    [self calculateRects:r];
    [bitmap setColor:@"black"];
    [bitmap drawHorizontalLineAtX:r.x x:r.x+r.w-1 y:r.y+r.h-1];
    [bitmap drawVerticalLineAtX:r.x+r.w-1 y:r.y y:r.y+r.h-1];
    if (hasFocus) {
        char *leftPalette = [Definitions cStringForMacPlatinumActiveTitleBarLeftPalette];
        char *rightPalette = [Definitions cStringForMacPlatinumActiveTitleBarRightPalette];
        char *left = [Definitions cStringForMacPlatinumActiveTitleBarLeft];
        char *middle = [Definitions cStringForMacPlatinumActiveTitleBarMiddle];
        char *right = [Definitions cStringForMacPlatinumActiveTitleBarRight];
        [Definitions drawInBitmap:bitmap left:left palette:leftPalette middle:middle palette:rightPalette right:right palette:rightPalette x:_titleBarRect.x y:_titleBarRect.y w:_titleBarRect.w];
    } else {
        char *palette = [Definitions cStringForMacPlatinumInactiveTitleBarPalette];
        char *left = [Definitions cStringForMacPlatinumInactiveTitleBarLeft];
        char *middle = [Definitions cStringForMacPlatinumInactiveTitleBarMiddle];
        char *right = [Definitions cStringForMacPlatinumInactiveTitleBarRight];
        [Definitions drawInBitmap:bitmap left:left palette:palette middle:middle palette:palette right:right palette:palette x:_titleBarRect.x y:_titleBarRect.y w:_titleBarRect.w];
    }
    if (_titleBarTextRect.w > 0) {
        id text = [context valueForKey:@"name"];
        if (!text) {
            text = @"(no title)";
        }

        text = [bitmap fitBitmapString:text width:_titleBarTextRect.w-14];
        if (text) {
            int textWidth = [Definitions bitmapWidthForText:text];
            int backWidth = textWidth + 14;
            int backX = _titleBarTextRect.x + ((_titleBarTextRect.w - backWidth) / 2);
            int textX = backX + 7;
            if (hasFocus) {
                char *palette = [Definitions cStringForMacPlatinumActiveTitleBarRightPalette];
                char *titleTextLeft = [Definitions cStringForMacPlatinumActiveTitleBarTextLeft];
                char *titleTextRight = [Definitions cStringForMacPlatinumActiveTitleBarTextRight];
                [bitmap setColor:@"#ccccccff"];
                [bitmap fillRect:[Definitions rectWithX:backX y:_titleBarTextRect.y+2 w:backWidth h:16]];
                [bitmap drawCString:titleTextLeft palette:palette x:backX y:_titleBarTextRect.y];
                [bitmap drawCString:titleTextRight palette:palette x:backX+backWidth-1 y:_titleBarTextRect.y];
                [bitmap setColorIntR:0 g:0 b:0 a:255];
                [bitmap drawBitmapText:text x:textX y:_titleBarTextRect.y+4];
            } else {
                [bitmap setColorIntR:0x77 g:0x77 b:0x77 a:255];
                [bitmap drawBitmapText:text x:textX y:_titleBarTextRect.y+4];
            }
        }
    }

    {
        char *palette = (hasFocus) ? [Definitions cStringForMacPlatinumLeftBorderPalette] : [Definitions cStringForMacPlatinumInactiveLeftBorderPalette];
        char *middle = [Definitions cStringForMacPlatinumLeftBorderMiddle];
        [Definitions drawInBitmap:bitmap top:middle palette:palette middle:middle palette:palette bottom:middle palette:palette x:_leftBorderRect.x y:_leftBorderRect.y h:_leftBorderRect.h];
    }
    if (hasFocus) {
        char *palette = [Definitions cStringForMacPlatinumRightBorderPalette];
        char *top = [Definitions cStringForMacPlatinumRightBorderTop];
        char *middle = [Definitions cStringForMacPlatinumRightBorderMiddle];
        char *bottom = [Definitions cStringForMacPlatinumRightBorderBottom];
        [Definitions drawInBitmap:bitmap top:middle palette:palette middle:middle palette:palette bottom:bottom palette:palette x:_rightBorderRect.x y:_rightBorderRect.y h:_rightBorderRect.h];
    } else {
        char *palette = [Definitions cStringForMacPlatinumInactiveRightBorderPalette];
        char *top = [Definitions cStringForMacPlatinumInactiveRightBorderTop];
        char *middle = [Definitions cStringForMacPlatinumInactiveRightBorderMiddle];
        char *bottom = [Definitions cStringForMacPlatinumInactiveRightBorderMiddle];
        [Definitions drawInBitmap:bitmap top:middle palette:palette middle:middle palette:palette bottom:bottom palette:palette x:_rightBorderRect.x y:_rightBorderRect.y h:_rightBorderRect.h];
    }

    if (hasFocus) {
        Int4 r = _bottomBorderRect;
        char *palette = [Definitions cStringForMacPlatinumBottomBorderPalette];
        char *left = [Definitions cStringForMacPlatinumBottomBorderLeft];
        char *middle = [Definitions cStringForMacPlatinumBottomBorderMiddle];
        char *right = [Definitions cStringForMacPlatinumBottomBorderRight];
        [Definitions drawInBitmap:bitmap left:left middle:middle right:right x:r.x y:r.y w:r.w palette:palette];
    } else {
        Int4 r = _bottomBorderRect;
        char *palette = [Definitions cStringForMacPlatinumInactiveBottomBorderPalette];
        char *left = [Definitions cStringForMacPlatinumInactiveBottomBorderLeft];
        char *middle = [Definitions cStringForMacPlatinumInactiveBottomBorderMiddle];
        char *right = [Definitions cStringForMacPlatinumInactiveBottomBorderRight];
        [Definitions drawInBitmap:bitmap left:left middle:middle right:right x:r.x y:r.y w:r.w palette:palette];
    }

    if (hasFocus) {
        if ((_buttonDown == 'c') && (_buttonHover == 'c')) {
            char *palette = [Definitions cStringForMacPlatinumCloseButtonDownPalette];
            char *closeButtonDown = [Definitions cStringForMacPlatinumCloseButtonDown];
            [bitmap drawCString:closeButtonDown palette:palette x:_closeButtonRect.x y:_closeButtonRect.y];
        }
        if ((_buttonDown == 'm') && (_buttonHover == 'm')) {
            char *palette = [Definitions cStringForMacPlatinumMaximizeButtonDownPalette];
            char *maximizeButtonDown = [Definitions cStringForMacPlatinumMaximizeButtonDown];
            [bitmap drawCString:maximizeButtonDown palette:palette x:_maximizeButtonRect.x y:_maximizeButtonRect.y];
        }
        if ((_buttonDown == 's') && (_buttonHover == 's')) {
            char *palette = [Definitions cStringForMacPlatinumShadeButtonDownPalette];
            char *shadeButtonDown = [Definitions cStringForMacPlatinumShadeButtonDown];
            [bitmap drawCString:shadeButtonDown palette:palette x:_shadeButtonRect.x y:_shadeButtonRect.y];
        }
        if (_buttonDown == 't') {
            char *palette = "b #000000\nw #ffffff\n";
            char *topLeft = [Definitions cStringForMacPlatinumMoveSelectionTopLeft];
            char *top = [Definitions cStringForMacPlatinumMoveSelectionTop];
            char *left = [Definitions cStringForMacPlatinumMoveSelectionLeft];
            char *right = [Definitions cStringForMacPlatinumMoveSelectionRight];
            char *bottom = [Definitions cStringForMacPlatinumMoveSelectionBottom];
            [Definitions drawInBitmap:bitmap left:topLeft middle:top right:right x:r.x y:r.y w:r.w palette:palette];
            [Definitions drawInBitmap:bitmap top:left palette:palette middle:left palette:palette bottom:bottom palette:palette x:r.x y:r.y+2 h:r.h-4];
            [Definitions drawInBitmap:bitmap top:right palette:palette middle:right palette:palette bottom:right palette:palette x:r.x+r.w-2 y:r.y+2 h:r.h-4];
            [Definitions drawInBitmap:bitmap left:bottom middle:bottom right:bottom x:r.x y:r.y+r.h-2 w:r.w palette:palette];
        }
        if (_buttonDown == 'r') {
            char *palette = "b #000000\nw #ffffff\n";
            char *h = [Definitions cStringForMacPlatinumResizeSelectionHorizontal];
            char *v = [Definitions cStringForMacPlatinumResizeSelectionVertical];
            [Definitions drawInBitmap:bitmap left:h middle:h right:h x:r.x y:r.y w:r.w palette:palette];
            [Definitions drawInBitmap:bitmap top:v palette:palette middle:v palette:palette bottom:v palette:palette x:r.x y:r.y+1 h:r.h-2];
            [Definitions drawInBitmap:bitmap top:v palette:palette middle:v palette:palette bottom:v palette:palette x:r.x+r.w-1 y:r.y+1 h:r.h-2];
            [Definitions drawInBitmap:bitmap left:h middle:h right:h x:r.x y:r.y+r.h-1 w:r.w palette:palette];

            [Definitions drawInBitmap:bitmap left:h middle:h right:h x:r.x+_leftBorder-1 y:r.y+_topBorder-1 w:r.w-(_leftBorder-1)-(_leftBorder-1) palette:palette];
            [Definitions drawInBitmap:bitmap top:v palette:palette middle:v palette:palette bottom:v palette:palette x:r.x+_leftBorder-1 y:r.y+_topBorder-1 h:r.h-(_topBorder-1)-5];
            [Definitions drawInBitmap:bitmap top:v palette:palette middle:v palette:palette bottom:v palette:palette x:r.x+r.w-7 y:r.y+_topBorder-1 h:r.h-(_topBorder-1)-(_bottomBorder-1)];
            [Definitions drawInBitmap:bitmap left:h middle:h right:h x:r.x+_leftBorder-1 y:r.y+r.h-7 w:r.w-(_leftBorder-1)-(_rightBorder-1) palette:palette];

            [Definitions drawInBitmap:bitmap top:v palette:palette middle:v palette:palette bottom:v palette:palette x:r.x+r.w-_rightBorder y:r.y+r.h-_bottomBorder h:_bottomBorder-5];
            [Definitions drawInBitmap:bitmap left:h middle:h right:h x:r.x+r.w-_rightBorder y:r.y+r.h-_bottomBorder w:_bottomBorder-5 palette:palette];
        }
    }

}
- (void)handleMouseDown:(id)event
{
    id windowManager = [event valueForKey:@"windowManager"];
    id x11dict = [event valueForKey:@"x11dict"];
    [windowManager setFocusDict:x11dict];
    int mouseX = [event intValueForKey:@"mouseX"];
    int mouseY = [event intValueForKey:@"mouseY"];
    int viewWidth = [event intValueForKey:@"viewWidth"];
    int viewHeight = [event intValueForKey:@"viewHeight"];
    if (mouseX >= viewWidth-21) {
        if (mouseY >= viewHeight-21) {
            _buttonDown = 'r';
            _buttonDownX = mouseX;
            _buttonDownY = mouseY;
            _buttonDownW = viewWidth;
            _buttonDownH = viewHeight;
            return;
        }
    }
    if ([Definitions isX:mouseX y:mouseY insideRect:_closeButtonRect]) {
        _buttonDown = 'c';
        _buttonHover = 'c';
        _buttonDownX = mouseX;
        _buttonDownY = mouseY;
        _buttonDownW = viewWidth;
        _buttonDownH = viewHeight;
        return;
    }
    if ([Definitions isX:mouseX y:mouseY insideRect:_maximizeButtonRect]) {
        _buttonDown = 'm';
        _buttonHover = 'm';
        _buttonDownX = mouseX;
        _buttonDownY = mouseY;
        _buttonDownW = viewWidth;
        _buttonDownH = viewHeight;
        return;
    }
    if ([Definitions isX:mouseX y:mouseY insideRect:_shadeButtonRect]) {
        _buttonDown = 's';
        _buttonHover = 's';
        _buttonDownX = mouseX;
        _buttonDownY = mouseY;
        _buttonDownW = viewWidth;
        _buttonDownH = viewHeight;
        return;
    }
    if ([Definitions isX:mouseX y:mouseY insideRect:_titleBarRect]
        || [Definitions isX:mouseX y:mouseY insideRect:_leftBorderRect]
        || [Definitions isX:mouseX y:mouseY insideRect:_rightBorderRect]
        || [Definitions isX:mouseX y:mouseY insideRect:_bottomBorderRect])
    {
        _buttonDown = 't';
        _buttonDownX = mouseX;
        _buttonDownY = mouseY;
        _buttonDownW = viewWidth;
        _buttonDownH = viewHeight;
        return;
    }
}
- (void)handleMouseMoved:(id)event
{
    if (_buttonDown == 'c') {
        int mouseX = [event intValueForKey:@"mouseX"];
        int mouseY = [event intValueForKey:@"mouseY"];
        if ([Definitions isX:mouseX y:mouseY insideRect:_closeButtonRect]) {
            _buttonHover = 'c';
        } else {
            _buttonHover = 0;
        }
        return;
    }
    if (_buttonDown == 'm') {
        int mouseX = [event intValueForKey:@"mouseX"];
        int mouseY = [event intValueForKey:@"mouseY"];
        if ([Definitions isX:mouseX y:mouseY insideRect:_maximizeButtonRect]) {
            _buttonHover = 'm';
        } else {
            _buttonHover = 0;
        }
        return;
    }
    if (_buttonDown == 's') {
        int mouseX = [event intValueForKey:@"mouseX"];
        int mouseY = [event intValueForKey:@"mouseY"];
        if ([Definitions isX:mouseX y:mouseY insideRect:_shadeButtonRect]) {
            _buttonHover = 's';
        } else {
            _buttonHover = 0;
        }
        return;
    }

    if (_buttonDown == 't') {
        id windowManager = [event valueForKey:@"windowManager"];
        int menuBarHeight = [windowManager intValueForKey:@"menuBarHeight"];
        int mouseRootX = [event intValueForKey:@"mouseRootX"];
        int mouseRootY = [event intValueForKey:@"mouseRootY"];
        int viewHeight = [event intValueForKey:@"viewHeight"];

        id dict = [event valueForKey:@"x11dict"];

        int newX = mouseRootX - _buttonDownX;
        int newY = mouseRootY - _buttonDownY;

        if (newX < 0) {
            newX = 0;
        }
        if (newY < menuBarHeight) {
            newY = menuBarHeight;
        }

        [dict setValue:nsfmt(@"%d %d", newX, newY) forKey:@"moveWindow"];

        return;
    }

    if (_buttonDown == 'r') {
        int mouseX = [event intValueForKey:@"mouseX"];
        int mouseY = [event intValueForKey:@"mouseY"];
        int viewWidth = [event intValueForKey:@"viewWidth"];
        int viewHeight = [event intValueForKey:@"viewHeight"];

        id dict = [event valueForKey:@"x11dict"];

        id windowManager = [event valueForKey:@"windowManager"];
        int newWidth = mouseX + (_buttonDownW - _buttonDownX);
        if (newWidth < 100) {
            newWidth = 100;
        }
        int newHeight = mouseY + (_buttonDownH - _buttonDownY);
        if (newHeight < 100) {
            newHeight = 100;
        }
        [dict setValue:nsfmt(@"%d %d", newWidth, newHeight) forKey:@"resizeWindow"];
        return;
    }
}
- (void)handleMouseUp:(id)event
{
    id dict = [event valueForKey:@"x11dict"];
    if ((_buttonDown == 'c') && (_buttonHover == 'c')) {
        [dict x11CloseWindow];
    }
    if ((_buttonDown == 'm') && (_buttonHover == 'm')) {
        [dict x11ToggleMaximizeWindow];
    }
    if ((_buttonDown == 's') && (_buttonHover == 's')) {
        [dict x11ToggleMaximizeWindow];
    }
    if (_buttonDown == 't') {
        /* this was added for Wine */
        [dict x11MoveChildWindowBackAndForthForWine];
    }

    _buttonDown = 0;
}
@end

